(function($,_1){var _2="selectbox",_3=false,_4=true;function _5(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null};};$.extend(_5.prototype,{_isOpenSelectbox:function(_6){if(!_6){return _3;}var _7=this._getInst(_6);return _7.isOpen;},_isDisabledSelectbox:function(_8){if(!_8){return _3;}var _9=this._getInst(_8);return _9.isDisabled;},_attachSelectbox:function(_a,_b){if(this._getInst(_a)){return _3;}var _c=$(_a),_d=this,_e=_d._newInst(_c),_f,_10,_11,_12,s=_3,_13=_c.find("optgroup"),_14=_c.find("option"),_15=_14.length;_c.attr("sb",_e.uid);$.extend(_e.settings,_d._defaults,_b);_d._state[_e.uid]=_3;_c.hide();function _16(){var key,sel,uid=this.attr("id").split("_")[1];for(key in _d._state){if(key!==uid){if(_d._state.hasOwnProperty(key)){sel=$("select[sb='"+key+"']")[0];if(sel){_d._closeSelectbox(sel);}}}}};_f=$("<div>",{"id":"sbHolder_"+_e.uid,"class":_e.settings.classHolder,"tabindex":_c.attr("tabindex")});_10=$("<a>",{"id":"sbSelector_"+_e.uid,"href":"#","class":_e.settings.classSelector,"click":function(e){e.preventDefault();_16.apply($(this),[]);var uid=$(this).attr("id").split("_")[1];if(_d._state[uid]){_d._closeSelectbox(_a);}else{_d._openSelectbox(_a);}}});_11=$("<a>",{"id":"sbToggle_"+_e.uid,"href":"#","class":_e.settings.classToggle,"click":function(e){e.preventDefault();_16.apply($(this),[]);var uid=$(this).attr("id").split("_")[1];if(_d._state[uid]){_d._closeSelectbox(_a);}else{_d._openSelectbox(_a);}}});_11.appendTo(_f);_12=$("<ul>",{"id":"sbOptions_"+_e.uid,"class":_e.settings.classOptions,"css":{"display":"none"}});_c.children().each(function(i){var _17=$(this),li,_18={};if(_17.is("option")){_19(_17);}else{if(_17.is("optgroup")){li=$("<li>");$("<span>",{"text":_17.attr("label")}).addClass(_e.settings.classGroup).appendTo(li);li.appendTo(_12);if(_17.is(":disabled")){_18.disabled=true;}_18.sub=true;_19(_17.find("option"),_18);}}});function _19(){var sub=arguments[1]&&arguments[1].sub?true:false,_1a=arguments[1]&&arguments[1].disabled?true:false;arguments[0].each(function(i){var _1b=$(this),li=$("<li>"),_1c;if(_1b.is(":selected")){_10.text(_1b.text());s=_4;}if(i===_15-1){li.addClass("last");}if(!_1b.is(":disabled")&&!_1a){_1c=$("<a>",{"href":"#"+_1b.val(),"class":_1b.attr("class"),"rel":_1b.val()}).text(_1b.text()).bind("click.sb",function(e){if(e&&e.preventDefault){e.preventDefault();}var t=_11,_1d=$(this),uid=t.attr("id").split("_")[1];_d._changeSelectbox(_a,_1d.attr("rel"),_1d.text());_d._closeSelectbox(_a);}).bind("mouseover.sb",function(){var _1e=$(this);_1e.parent().siblings().find("a").removeClass(_e.settings.classFocus);_1e.addClass(_e.settings.classFocus);}).bind("mouseout.sb",function(){$(this).removeClass(_e.settings.classFocus);});if(sub){_1c.addClass(_e.settings.classSub);}if(_1b.is(":selected")){_1c.addClass(_e.settings.classFocus);}_1c.appendTo(li);}else{_1c=$("<span>",{"text":_1b.text()}).addClass(_e.settings.classDisabled);if(sub){_1c.addClass(_e.settings.classSub);}_1c.appendTo(li);}li.appendTo(_12);});};if(!s){_10.text(_14.first().text());}$.data(_a,_2,_e);_f.data("uid",_e.uid).bind("keydown.sb",function(e){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0,_1f=$(this),uid=_1f.data("uid"),_22=_1f.siblings("select[sb='"+uid+"']").data(_2),_20=_1f.siblings(["select[sb='",uid,"']"].join("")).get(0),$f=_1f.find("ul").find("a."+_22.settings.classFocus);switch(key){case 37:case 38:if($f.length>0){var _21;$("a",_1f).removeClass(_22.settings.classFocus);_21=$f.parent().prevAll("li:has(a)").eq(0).find("a");if(_21.length>0){_21.addClass(_22.settings.classFocus).focus();$("#sbSelector_"+uid).text(_21.text());}}break;case 39:case 40:var _21;$("a",_1f).removeClass(_22.settings.classFocus);if($f.length>0){_21=$f.parent().nextAll("li:has(a)").eq(0).find("a");}else{_21=_1f.find("ul").find("a").eq(0);}if(_21.length>0){_21.addClass(_22.settings.classFocus).focus();$("#sbSelector_"+uid).text(_21.text());}break;case 13:if($f.length>0){_d._changeSelectbox(_20,$f.attr("rel"),$f.text());}_d._closeSelectbox(_20);break;case 9:if(_20){var _22=_d._getInst(_20);if(_22){if($f.length>0){_d._changeSelectbox(_20,$f.attr("rel"),$f.text());}_d._closeSelectbox(_20);}}var i=parseInt(_1f.attr("tabindex"),10);if(!e.shiftKey){i++;}else{i--;}$("*[tabindex='"+i+"']").focus();break;case 27:_d._closeSelectbox(_20);break;}e.stopPropagation();return false;}).delegate("a","mouseover",function(e){$(this).addClass(_e.settings.classFocus);}).delegate("a","mouseout",function(e){$(this).removeClass(_e.settings.classFocus);});_10.appendTo(_f);_12.appendTo(_f);_f.insertAfter(_c);$("html").live("mousedown",function(e){e.stopPropagation();$("select").selectbox("close");});$([".",_e.settings.classHolder,", .",_e.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation();});},_detachSelectbox:function(_23){var _24=this._getInst(_23);if(!_24){return _3;}$("#sbHolder_"+_24.uid).remove();$.data(_23,_2,null);$(_23).show();},_changeSelectbox:function(_25,_26,_27){var _28,_29=this._getInst(_25);if(_29){_28=this._get(_29,"onChange");$("#sbSelector_"+_29.uid).text(_27);}_26=_26.replace(/\'/g,"\\'");$(_25).find("option[value='"+_26+"']").attr("selected",_4);if(_29&&_28){_28.apply((_29.input?_29.input[0]:null),[_26,_29]);}else{if(_29&&_29.input){_29.input.trigger("change");}}},_enableSelectbox:function(_2a){var _2b=this._getInst(_2a);if(!_2b||!_2b.isDisabled){return _3;}$("#sbHolder_"+_2b.uid).removeClass(_2b.settings.classHolderDisabled);_2b.isDisabled=_3;$.data(_2a,_2,_2b);},_disableSelectbox:function(_2c){var _2d=this._getInst(_2c);if(!_2d||_2d.isDisabled){return _3;}$("#sbHolder_"+_2d.uid).addClass(_2d.settings.classHolderDisabled);_2d.isDisabled=_4;$.data(_2c,_2,_2d);},_optionSelectbox:function(_2e,_2f,_30){var _31=this._getInst(_2e);if(!_31){return _3;}_31[_2f]=_30;$.data(_2e,_2,_31);},_openSelectbox:function(_32){var _33=this._getInst(_32);if(!_33||_33.isOpen||_33.isDisabled){return;}var el=$("#sbOptions_"+_33.uid),_34=parseInt($(window).height(),10),_35=$("#sbHolder_"+_33.uid).offset(),_36=$(window).scrollTop(),_37=el.prev().height(),_38=_34-(_35.top-_36)-_37/2,_39=this._get(_33,"onOpen");el.css({"top":_37+"px","maxHeight":(_38-_37)+"px"});_33.settings.effect==="fade"?el.fadeIn(_33.settings.speed):el.slideDown(_33.settings.speed);$("#sbToggle_"+_33.uid).addClass(_33.settings.classToggleOpen);this._state[_33.uid]=_4;_33.isOpen=_4;if(_39){_39.apply((_33.input?_33.input[0]:null),[_33]);}$.data(_32,_2,_33);},_closeSelectbox:function(_3a){var _3b=this._getInst(_3a);if(!_3b||!_3b.isOpen){return;}var _3c=this._get(_3b,"onClose");_3b.settings.effect==="fade"?$("#sbOptions_"+_3b.uid).fadeOut(_3b.settings.speed):$("#sbOptions_"+_3b.uid).slideUp(_3b.settings.speed);$("#sbToggle_"+_3b.uid).removeClass(_3b.settings.classToggleOpen);this._state[_3b.uid]=_3;_3b.isOpen=_3;if(_3c){_3c.apply((_3b.input?_3b.input[0]:null),[_3b]);}$.data(_3a,_2,_3b);},_newInst:function(_3d){var id=_3d[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return {id:id,input:_3d,uid:Math.floor(Math.random()*99999999),isOpen:_3,isDisabled:_3,settings:{}};},_getInst:function(_3e){try{return $.data(_3e,_2);}catch(err){throw "Missing instance data for this selectbox";}},_get:function(_3f,_40){return _3f.settings[_40]!==_1?_3f.settings[_40]:this._defaults[_40];}});$.fn.selectbox=function(_41){var _42=Array.prototype.slice.call(arguments,1);if(typeof _41=="string"&&_41=="isDisabled"){return $.selectbox["_"+_41+"Selectbox"].apply($.selectbox,[this[0]].concat(_42));}if(_41=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return $.selectbox["_"+_41+"Selectbox"].apply($.selectbox,[this[0]].concat(_42));}return this.each(function(){typeof _41=="string"?$.selectbox["_"+_41+"Selectbox"].apply($.selectbox,[this].concat(_42)):$.selectbox._attachSelectbox(this,_41);});};$.selectbox=new _5();$.selectbox.version="0.2";})(jQuery);